<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-tutorials/sql_qa" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.5.2">
<title data-rh="true">Build a Question/Answering system over SQL data | ü¶úÔ∏èüîó LangChain</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://python.langchain.com/img/brand/theme-image.png"><meta data-rh="true" name="twitter:image" content="https://python.langchain.com/img/brand/theme-image.png"><meta data-rh="true" property="og:url" content="https://python.langchain.com/docs/tutorials/sql_qa/"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Build a Question/Answering system over SQL data | ü¶úÔ∏èüîó LangChain"><meta data-rh="true" name="description" content="This guide assumes familiarity with the following concepts:"><meta data-rh="true" property="og:description" content="This guide assumes familiarity with the following concepts:"><link data-rh="true" rel="icon" href="/img/brand/favicon.png"><link data-rh="true" rel="canonical" href="https://python.langchain.com/docs/tutorials/sql_qa/"><link data-rh="true" rel="alternate" href="https://python.langchain.com/docs/tutorials/sql_qa/" hreflang="en"><link data-rh="true" rel="alternate" href="https://python.langchain.com/docs/tutorials/sql_qa/" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://VAU016LAWS-dsn.algolia.net" crossorigin="anonymous"><link rel="search" type="application/opensearchdescription+xml" title="ü¶úÔ∏èüîó LangChain" href="/opensearch.xml">


<script src="/js/google_analytics.js"></script>
<script src="https://www.googletagmanager.com/gtag/js?id=G-9B66JQQH2F" async></script><link rel="stylesheet" href="/assets/css/styles.12df7c44.css">
<script src="/assets/js/runtime~main.1cfdb270.js" defer="defer"></script>
<script src="/assets/js/main.e0eb6091.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/brand/wordmark.png" alt="ü¶úÔ∏èüîó LangChain" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/brand/wordmark-dark.png" alt="ü¶úÔ∏èüîó LangChain" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a class="navbar__item navbar__link" href="/docs/integrations/providers/">Integrations</a><a href="https://python.langchain.com/api_reference/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">API Reference</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">More</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/contributing/">Contributing</a></li><li><a class="dropdown__link" href="/docs/people/">People</a></li><li><a class="dropdown__link" href="/docs/troubleshooting/errors/">Error reference</a></li><li><hr class="dropdown-separator" style="margin-top: 0.5rem; margin-bottom: 0.5rem"></li><li><a href="https://docs.smith.langchain.com" target="_blank" rel="noopener noreferrer" class="dropdown__link">LangSmith<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://langchain-ai.github.io/langgraph/" target="_blank" rel="noopener noreferrer" class="dropdown__link">LangGraph<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://smith.langchain.com/hub" target="_blank" rel="noopener noreferrer" class="dropdown__link">LangChain Hub<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://js.langchain.com" target="_blank" rel="noopener noreferrer" class="dropdown__link">LangChain JS/TS<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">v0.3</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/introduction/">v0.3</a></li><li><a href="https://python.langchain.com/v0.2/docs/introduction" target="_blank" rel="noopener noreferrer" class="dropdown__link">v0.2<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://python.langchain.com/v0.1/docs/get_started/introduction" target="_blank" rel="noopener noreferrer" class="dropdown__link">v0.1<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><a href="https://chat.langchain.com" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">üí¨</a><a href="https://github.com/langchain-ai/langchain" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20" aria-hidden="true"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/introduction/">Introduction</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--active" href="/docs/tutorials/">Tutorials</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/tutorials/graph/">Build a Question Answering application over a Graph Database</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/tutorials/">Tutorials</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/tutorials/llm_chain/">Build a simple LLM application with chat models and prompt templates</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/tutorials/chatbot/">Build a Chatbot</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/tutorials/qa_chat_history/">Build a Retrieval Augmented Generation (RAG) App: Part 2</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/tutorials/extraction/">Build an Extraction Chain</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/tutorials/agents/">Build an Agent</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/tutorials/classification/">Tagging</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/tutorials/rag/">Build a Retrieval Augmented Generation (RAG) App: Part 1</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/tutorials/retrievers/">Build a semantic search engine</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/tutorials/sql_qa/">Build a Question/Answering system over SQL data</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/tutorials/summarization/">Summarize Text</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link" href="/docs/how_to/">How-to guides</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/">How-to guides</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/tools_chain/">How to use tools in a chain</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/vectorstore_retriever/">How to use a vectorstore as a retriever</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/chatbots_memory/">How to add memory to chatbots</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/example_selectors/">How to use example selectors</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/graph_semantic/">How to add a semantic layer over graph database</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/parallel/">How to invoke runnables in parallel</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/chat_streaming/">How to stream chat model responses</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/binding/">How to add default invocation args to a Runnable</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/chatbots_retrieval/">How to add retrieval to chatbots</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/few_shot_examples_chat/">How to use few shot examples in chat models</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/function_calling/">How to do tool/function calling</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/installation/">How to install LangChain packages</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/query_few_shot/">How to add examples to the prompt for query analysis</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/few_shot_examples/">How to use few shot examples</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/functions/">How to run custom functions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/output_parser_structured/">How to use output parsers to parse an LLM response into structured format</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/query_no_queries/">How to handle cases where no queries are generated</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/routing/">How to route between sub-chains</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/structured_output/">How to return structured data from a model</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/summarize_map_reduce/">How to summarize text through parallelization</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/summarize_refine/">How to summarize text through iterative refinement</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/summarize_stuff/">How to summarize text in a single LLM call</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/toolkits/">How to use toolkits</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/tools_prompting/">How to add ad-hoc tool calling capability to LLMs and Chat Models</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/agent_executor/">Build an Agent with AgentExecutor (Legacy)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/graph_constructing/">How to construct knowledge graphs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/prompts_partial/">How to partially format prompt templates</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/query_multiple_queries/">How to handle multiple queries when doing query analysis</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/tools_builtin/">How to use built-in tools and toolkits</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/passthrough/">How to pass through arguments from one step to the next</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/prompts_composition/">How to compose prompts together</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/query_multiple_retrievers/">How to handle multiple retrievers when doing query analysis</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/assign/">How to add values to a chain&#x27;s state</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/query_constructing_filters/">How to construct filters for query analysis</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/configure/">How to configure runtime chain internals</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/query_high_cardinality/">How deal with high cardinality categoricals when doing query analysis</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/document_loader_custom/">Custom Document Loader</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/MultiQueryRetriever/">How to use the MultiQueryRetriever</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/add_scores_retriever/">How to add scores to retriever results</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/caching_embeddings/">Caching</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/callbacks_async/">How to use callbacks in async environments</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/callbacks_attach/">How to attach callbacks to a runnable</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/callbacks_constructor/">How to propagate callbacks  constructor</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/callbacks_custom_events/">How to dispatch custom callback events</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/callbacks_runtime/">How to pass callbacks in at runtime</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/character_text_splitter/">How to split by character</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/chat_model_caching/">How to cache chat model responses</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/chat_model_rate_limiting/">How to handle rate limits</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/chat_models_universal_init/">How to init any model in one line</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/chat_token_usage_tracking/">How to track token usage in ChatModels</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/chatbots_tools/">How to add tools to chatbots</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/code_splitter/">How to split code</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/contextual_compression/">How to do retrieval with contextual compression</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/convert_runnable_to_tool/">How to convert Runnables to Tools</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/custom_callbacks/">How to create custom callback handlers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/custom_chat_model/">How to create a custom chat model class</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/custom_embeddings/">Custom Embeddings</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/custom_llm/">How to create a custom LLM class</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/custom_retriever/">Custom Retriever</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/custom_tools/">How to create tools</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/debugging/">How to debug your LLM apps</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/document_loader_csv/">How to load CSVs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/document_loader_directory/">How to load documents from a directory</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/document_loader_html/">How to load HTML</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/document_loader_json/">How to load JSON</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/document_loader_markdown/">How to load Markdown</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/document_loader_office_file/">How to load Microsoft Office files</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/document_loader_pdf/">How to load PDFs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/document_loader_web/">How to load web pages</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/dynamic_chain/">How to create a dynamic (self-constructing) chain</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/embed_text/">Text embedding models</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/ensemble_retriever/">How to combine results from multiple retrievers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/example_selectors_langsmith/">How to select examples from a LangSmith dataset</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/example_selectors_length_based/">How to select examples by length</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/example_selectors_mmr/">How to select examples by maximal marginal relevance (MMR)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/example_selectors_ngram/">How to select examples by n-gram overlap</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/example_selectors_similarity/">How to select examples by similarity</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/extraction_examples/">How to use reference examples when doing extraction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/extraction_long_text/">How to handle long text when doing extraction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/extraction_parse/">How to use prompting alone (no tool calling) to do extraction</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/fallbacks/">How to add fallbacks to a runnable</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/filter_messages/">How to filter messages</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/hybrid/">Hybrid Search</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/indexing/">How to use the LangChain indexing API</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/inspect/">How to inspect runnables</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/lcel_cheatsheet/">LangChain Expression Language Cheatsheet</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/llm_caching/">How to cache LLM responses</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/llm_token_usage_tracking/">How to track token usage for LLMs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/local_llms/">Run models locally</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/logprobs/">How to get log probabilities</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/long_context_reorder/">How to reorder retrieved results to mitigate the &quot;lost in the middle&quot; effect</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/markdown_header_metadata_splitter/">How to split Markdown by Headers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/merge_message_runs/">How to merge consecutive messages of the same type</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/message_history/">How to add message history</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/migrate_agent/">How to migrate from legacy LangChain agents to LangGraph</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/multi_vector/">How to retrieve using multiple vectors per document</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/multimodal_inputs/">How to pass multimodal data directly to models</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/multimodal_prompts/">How to use multimodal prompts</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/output_parser_custom/">How to create a custom Output Parser</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/output_parser_fixing/">How to use the output-fixing parser</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/output_parser_json/">How to parse JSON output</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/output_parser_retry/">How to retry when a parsing error occurs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/output_parser_string/">How to parse text from message objects</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/output_parser_xml/">How to parse XML output</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/output_parser_yaml/">How to parse YAML output</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/parent_document_retriever/">How to use the Parent Document Retriever</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/pydantic_compatibility/">How to use LangChain with different Pydantic versions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/qa_chat_history_how_to/">How to add chat history</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/qa_citations/">How to get a RAG application to add citations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/qa_per_user/">How to do per-user retrieval</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/qa_sources/">How to get your RAG application to return sources</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/qa_streaming/">How to stream results from your RAG application</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/recursive_json_splitter/">How to split JSON data</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/recursive_text_splitter/">How to recursively split text by characters</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/response_metadata/">Response metadata</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/runnable_runtime_secrets/">How to pass runtime secrets to runnables</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/self_query/">How to do &quot;self-querying&quot; retrieval</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/semantic-chunker/">How to split text based on semantic similarity</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/sequence/">How to chain runnables</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/serialization/">How to save and load LangChain objects</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/split_by_token/">How to split text by tokens</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/split_html/">How to split HTML</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/sql_csv/">How to do question answering over CSVs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/sql_large_db/">How to deal with large databases when doing SQL question-answering</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/sql_prompting/">How to better prompt when doing SQL question-answering</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/sql_query_checking/">How to do query validation as part of SQL question-answering</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/streaming/">How to stream runnables</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/streaming_llm/">How to stream responses from an LLM</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/time_weighted_vectorstore/">How to use a time-weighted vector store retriever</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/tool_artifacts/">How to return artifacts from a tool</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/tool_calling/">How to use chat models to call tools</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/tool_calling_parallel/">How to disable parallel tool calling</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/tool_choice/">How to force models to call a tool</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/tool_configure/">How to access the RunnableConfig from a tool</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/tool_results_pass_to_model/">How to pass tool outputs to chat models</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/tool_runtime/">How to pass run time values to tools</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/tool_stream_events/">How to stream events from a tool</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/tool_streaming/">How to stream tool calls</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/tools_as_openai_functions/">How to convert tools to OpenAI Functions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/tools_error/">How to handle tool errors</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/tools_few_shot/">How to use few-shot prompting with tool calling</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/tools_human/">How to add a human-in-the-loop for tools</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/tools_model_specific/">How to bind model-specific tools</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/trim_messages/">How to trim messages</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/how_to/vectorstores/">How to create and query vector stores</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link" href="/docs/concepts/">Conceptual guide</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/concepts/agents/">Agents</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/concepts/architecture/">Architecture</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/concepts/async/">Async programming with langchain</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/concepts/callbacks/">Callbacks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/concepts/chat_history/">Chat history</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/concepts/chat_models/">Chat models</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/concepts/document_loaders/">Document loaders</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/concepts/embedding_models/">Embedding models</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/concepts/evaluation/">Evaluation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/concepts/example_selectors/">Example selectors</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/concepts/few_shot_prompting/">Few-shot prompting</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/concepts/">Conceptual guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/concepts/key_value_stores/">Key-value stores</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/concepts/lcel/">LangChain Expression Language (LCEL)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/concepts/messages/">Messages</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/concepts/multimodality/">Multimodality</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/concepts/output_parsers/">Output parsers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/concepts/prompt_templates/">Prompt Templates</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/concepts/rag/">Retrieval augmented generation (RAG)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/concepts/retrieval/">Retrieval</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/concepts/retrievers/">Retrievers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/concepts/runnables/">Runnable interface</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/concepts/streaming/">Streaming</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/concepts/structured_outputs/">Structured outputs</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/concepts/testing/">Testing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/concepts/text_llms/">String-in, string-out llms</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/concepts/text_splitters/">Text splitters</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/concepts/tokens/">Tokens</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/concepts/tool_calling/">Tool calling</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/concepts/tools/">Tools</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/concepts/tracing/">Tracing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/concepts/vectorstores/">Vector stores</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/concepts/why_langchain/">Why LangChain?</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">Ecosystem</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a href="https://docs.smith.langchain.com/" target="_blank" rel="noopener noreferrer" class="menu__link menuExternalLink_NmtK" tabindex="0">ü¶úüõ†Ô∏è LangSmith<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a href="https://langchain-ai.github.io/langgraph/" target="_blank" rel="noopener noreferrer" class="menu__link menuExternalLink_NmtK" tabindex="0">ü¶úüï∏Ô∏è LangGraph<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link">Versions</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/versions/v0_3/">v0.3</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/versions/v0_2/overview/">v0.2</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/how_to/pydantic_compatibility/">Pydantic compatibility</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link" tabindex="0" href="/docs/versions/migrating_chains/">Migrating from v0.0 chains</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/versions/migrating_chains/">How to migrate from v0.0 chains</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/versions/migrating_chains/constitutional_chain/">Migrating from ConstitutionalChain</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/versions/migrating_chains/conversation_chain/">Migrating from ConversationalChain</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/versions/migrating_chains/conversation_retrieval_chain/">Migrating from ConversationalRetrievalChain</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/versions/migrating_chains/llm_chain/">Migrating from LLMChain</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/versions/migrating_chains/llm_math_chain/">Migrating from LLMMathChain</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/versions/migrating_chains/llm_router_chain/">Migrating from LLMRouterChain</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/versions/migrating_chains/map_reduce_chain/">Migrating from MapReduceDocumentsChain</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/versions/migrating_chains/map_rerank_docs_chain/">Migrating from MapRerankDocumentsChain</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/versions/migrating_chains/multi_prompt_chain/">Migrating from MultiPromptChain</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/versions/migrating_chains/refine_docs_chain/">Migrating from RefineDocumentsChain</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/versions/migrating_chains/retrieval_qa/">Migrating from RetrievalQA</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/versions/migrating_chains/stuff_docs_chain/">Migrating from StuffDocumentsChain</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link" tabindex="0" href="/docs/versions/migrating_memory/">Upgrading to LangGraph memory</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/versions/migrating_memory/">How to migrate to LangGraph memory</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/versions/migrating_memory/chat_history/">How to use BaseChatMessageHistory with LangGraph</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/versions/migrating_memory/conversation_buffer_memory/">Migrating off ConversationBufferMemory or ConversationStringBufferMemory</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/versions/migrating_memory/conversation_buffer_window_memory/">Migrating off ConversationBufferWindowMemory or ConversationTokenBufferMemory</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/versions/migrating_memory/conversation_summary_memory/">Migrating off ConversationSummaryMemory or ConversationSummaryBufferMemory</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item hidden"><a class="menu__link" tabindex="0" href="/docs/versions/migrating_memory/long_term_memory_agent/">A Long-Term Memory Agent</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/versions/release_policy/">Release policy</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/security/">Security Policy</a></li></ul></nav><button type="button" title="Collapse sidebar" aria-label="Collapse sidebar" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_z5aJ"><div class="docItemContainer_c0TR"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/tutorials/"><span itemprop="name">Tutorials</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Build a Question/Answering system over SQL data</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div style="display:flex;flex-direction:column;align-items:flex-end;float:right;margin-left:12px"><a target="_blank" href="https://colab.research.google.com/github/langchain-ai/langchain/blob/master/docs/docs/tutorials/sql_qa.ipynb"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"></a><a href="https://github.com/langchain-ai/langchain/blob/master/docs/docs/tutorials/sql_qa.ipynb" target="_blank"><img src="https://img.shields.io/badge/Open%20on%20GitHub-grey?logo=github&amp;logoColor=white" alt="Open on GitHub"></a></div><div class="theme-doc-markdown markdown"><header><h1>Build a Question/Answering system over SQL data</h1></header>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>Prerequisites</div><div class="admonitionContent_BuS1"><p>This guide assumes familiarity with the following concepts:</p><ul>
<li><a href="/docs/concepts/chat_models/">Chat models</a></li>
<li><a href="/docs/concepts/tools/">Tools</a></li>
<li><a href="/docs/concepts/agents/">Agents</a></li>
<li><a href="/docs/concepts/architecture/#langgraph">LangGraph</a></li>
</ul></div></div>
<p>Enabling a LLM system to query structured data can be qualitatively different from unstructured text data. Whereas in the latter it is common to generate text that can be searched against a vector database, the approach for structured data is often for the LLM to write and execute queries in a DSL, such as SQL. In this guide we&#x27;ll go over the basic ways to create a Q&amp;A system over tabular data in databases. We will cover implementations using both <a href="/docs/tutorials/sql_qa/#chains">chains</a> and <a href="/docs/tutorials/sql_qa/#agents">agents</a>. These systems will allow us to ask a question about the data in a database and get back a natural language answer. The main difference between the two is that our agent can query the database in a loop as many times as it needs to answer the question.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="Ô∏è-security-note-Ô∏è">‚ö†Ô∏è Security note ‚ö†Ô∏è<a href="#Ô∏è-security-note-Ô∏è" class="hash-link" aria-label="Direct link to ‚ö†Ô∏è Security note ‚ö†Ô∏è" title="Direct link to ‚ö†Ô∏è Security note ‚ö†Ô∏è">‚Äã</a></h2>
<p>Building Q&amp;A systems of SQL databases requires executing model-generated SQL queries. There are inherent risks in doing this. Make sure that your database connection permissions are always scoped as narrowly as possible for your chain/agent&#x27;s needs. This will mitigate though not eliminate the risks of building a model-driven system. For more on general security best practices, <a href="/docs/security/">see here</a>.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="architecture">Architecture<a href="#architecture" class="hash-link" aria-label="Direct link to Architecture" title="Direct link to Architecture">‚Äã</a></h2>
<p>At a high-level, the steps of these systems are:</p>
<ol>
<li><strong>Convert question to SQL query</strong>: Model converts user input to a SQL query.</li>
<li><strong>Execute SQL query</strong>: Execute the query.</li>
<li><strong>Answer the question</strong>: Model responds to user input using the query results.</li>
</ol>
<p>Note that querying data in CSVs can follow a similar approach. See our <a href="/docs/how_to/sql_csv/">how-to guide</a> on question-answering over CSV data for more detail.</p>
<p><img decoding="async" loading="lazy" alt="sql_usecase.png" src="/assets/images/sql_usecase-d432701261f05ab69b38576093718cf3.png" width="1571" height="470" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="setup">Setup<a href="#setup" class="hash-link" aria-label="Direct link to Setup" title="Direct link to Setup">‚Äã</a></h2>
<p>First, get required packages and set environment variables:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#F5F5F5"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token operator" style="color:rgb(0, 0, 0)">%</span><span class="token operator" style="color:rgb(0, 0, 0)">%</span><span class="token plain">capture </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">no</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">stderr</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token operator" style="color:rgb(0, 0, 0)">%</span><span class="token plain">pip install </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">upgrade </span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">quiet langchain</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token plain">community langchainhub langgraph</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#F5F5F5"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># Comment out the below to opt-out of using LangSmith in this notebook. Not required.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">not</span><span class="token plain"> os</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">environ</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">get</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;LANGSMITH_API_KEY&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    os</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">environ</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;LANGSMITH_API_KEY&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> getpass</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">getpass</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    os</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">environ</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;LANGSMITH_TRACING&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;true&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="sample-data">Sample data<a href="#sample-data" class="hash-link" aria-label="Direct link to Sample data" title="Direct link to Sample data">‚Äã</a></h3>
<p>The below example will use a SQLite connection with the Chinook database, which is a sample database that represents a digital media store. Follow <a href="https://database.guide/2-sample-databases-sqlite/" target="_blank" rel="noopener noreferrer">these installation steps</a> to create <code>Chinook.db</code> in the same directory as this notebook. You can also download and build the database via the command line:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#F5F5F5"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">curl -s https://raw.githubusercontent.com/lerocha/chinook-database/master/ChinookDatabase/DataSources/Chinook_Sqlite.sql | sqlite3 Chinook.db</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now, <code>Chinook.db</code> is in our directory and we can interface with it using the SQLAlchemy-driven <code>SQLDatabase</code> class:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#F5F5F5"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">from</span><span class="token plain"> langchain_community</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">utilities </span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> SQLDatabase</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">db </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> SQLDatabase</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">from_uri</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;sqlite:///Chinook.db&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">db</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">dialect</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">db</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">get_usable_table_names</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">db</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;SELECT * FROM Artist LIMIT 10;&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div style="padding-top:1.3rem;background:var(--prism-background-color);color:var(--prism-color);margin-top:calc(-1 * var(--ifm-leading) - 5px);margin-bottom:var(--ifm-leading);box-shadow:var(--ifm-global-shadow-lw);border-bottom-left-radius:var(--ifm-code-border-radius);border-bottom-right-radius:var(--ifm-code-border-radius)"><b style="padding-left:0.65rem;margin-bottom:0.45rem;margin-right:0.5rem">API Reference:</b><span><a href="https://python.langchain.com/api_reference/community/utilities/langchain_community.utilities.sql_database.SQLDatabase.html">SQLDatabase</a></span></div>
<div class="language-output codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-output codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#F5F5F5"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">sqlite</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">[&#x27;Album&#x27;, &#x27;Artist&#x27;, &#x27;Customer&#x27;, &#x27;Employee&#x27;, &#x27;Genre&#x27;, &#x27;Invoice&#x27;, &#x27;InvoiceLine&#x27;, &#x27;MediaType&#x27;, &#x27;Playlist&#x27;, &#x27;PlaylistTrack&#x27;, &#x27;Track&#x27;]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-output codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-output codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#F5F5F5"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">&quot;[(1, &#x27;AC/DC&#x27;), (2, &#x27;Accept&#x27;), (3, &#x27;Aerosmith&#x27;), (4, &#x27;Alanis Morissette&#x27;), (5, &#x27;Alice In Chains&#x27;), (6, &#x27;Ant√¥nio Carlos Jobim&#x27;), (7, &#x27;Apocalyptica&#x27;), (8, &#x27;Audioslave&#x27;), (9, &#x27;BackBeat&#x27;), (10, &#x27;Billy Cobham&#x27;)]&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Great! We&#x27;ve got a SQL database that we can query. Now let&#x27;s try hooking it up to an LLM.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="chains">Chains<a href="#chains" class="hash-link" aria-label="Direct link to Chains" title="Direct link to Chains">‚Äã</a></h2>
<p>Chains are compositions of predictable steps. In <a href="/docs/concepts/architecture/#langgraph">LangGraph</a>, we can represent a chain via simple sequence of nodes. Let&#x27;s create a sequence of steps that, given a question, does the following:</p>
<ul>
<li>converts the question into a SQL query;</li>
<li>executes the query;</li>
<li>uses the result to answer the original question.</li>
</ul>
<p>There are scenarios not supported by this arrangement. For example, this system will execute a SQL query for any user input-- even &quot;hello&quot;. Importantly, as we&#x27;ll see below, some questions require more than one query to answer. We will address these scenarios in the Agents section.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="application-state">Application state<a href="#application-state" class="hash-link" aria-label="Direct link to Application state" title="Direct link to Application state">‚Äã</a></h3>
<p>The LangGraph <a href="https://langchain-ai.github.io/langgraph/concepts/low_level/#state" target="_blank" rel="noopener noreferrer">state</a> of our application controls what data is input to the application, transferred between steps, and output by the application. It is typically a <code>TypedDict</code>, but can also be a <a href="https://langchain-ai.github.io/langgraph/how-tos/state-model/" target="_blank" rel="noopener noreferrer">Pydantic BaseModel</a>.</p>
<p>For this application, we can just keep track of the input question, generated query, query result, and generated answer:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#F5F5F5"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">from</span><span class="token plain"> typing_extensions </span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> TypedDict</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">State</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">TypedDict</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    question</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(0, 112, 193)">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    query</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(0, 112, 193)">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    result</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(0, 112, 193)">str</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    answer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(0, 112, 193)">str</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now we just need functions that operate on this state and populate its contents.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="convert-question-to-sql-query">Convert question to SQL query<a href="#convert-question-to-sql-query" class="hash-link" aria-label="Direct link to Convert question to SQL query" title="Direct link to Convert question to SQL query">‚Äã</a></h3>
<p>The first step is to take the user input and convert it to a SQL query. To reliably obtain SQL queries (absent markdown formatting and explanations or clarifications), we will make use of LangChain&#x27;s <a href="/docs/concepts/structured_outputs/">structured output</a> abstraction.</p>
<p>Let&#x27;s select a chat model for our application:</p>
<!-- -->
<div><div style="display:flex;align-items:center;margin-bottom:1rem;gap:0.75rem"><span style="font-size:1rem;font-weight:500">Select <a href="/docs/integrations/chat/">chat model</a>:</span><div class="dropdown"><button class="button button--secondary" style="background-color:var(--ifm-background-color);border:1px solid var(--ifm-color-emphasis-300);font-weight:normal;font-size:1rem;padding:0.5rem 1rem;color:var(--ifm-font-color-base)">OpenAI<span style="margin-left:0.4rem;font-size:0.875rem">‚ñæ</span></button><div class="dropdown__menu" style="max-height:210px;overflow-y:auto;overflow-x:hidden;margin-bottom:0"><li><a class="dropdown__link dropdown__link--active" href="#">OpenAI</a></li><li><a class="dropdown__link" href="#">Anthropic</a></li><li><a class="dropdown__link" href="#">Azure</a></li><li><a class="dropdown__link" href="#">Google</a></li><li><a class="dropdown__link" href="#">AWS</a></li><li><a class="dropdown__link" href="#">Cohere</a></li><li><a class="dropdown__link" href="#">NVIDIA</a></li><li><a class="dropdown__link" href="#">Fireworks AI</a></li><li><a class="dropdown__link" href="#">Groq</a></li><li><a class="dropdown__link" href="#">Mistral AI</a></li><li><a class="dropdown__link" href="#">Together AI</a></li><li><a class="dropdown__link" href="#">Databricks</a></li></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#F5F5F5"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">pip install -qU langchain-openai</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#F5F5F5"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> getpass</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> os</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">not</span><span class="token plain"> os</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">environ</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">get</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;OPENAI_API_KEY&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  os</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">environ</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;OPENAI_API_KEY&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> getpass</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">getpass</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Enter API key for OpenAI: &quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">from</span><span class="token plain"> langchain_openai </span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> ChatOpenAI</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">llm </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> ChatOpenAI</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">model</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;gpt-4o-mini&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div>
<p>We will pull a prompt from the <a href="https://smith.langchain.com/hub" target="_blank" rel="noopener noreferrer">Prompt Hub</a> to instruct the model.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#F5F5F5"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">from</span><span class="token plain"> langchain </span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> hub</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">query_prompt_template </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> hub</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">pull</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;langchain-ai/sql-query-system-prompt&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">assert</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(0, 112, 193)">len</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">query_prompt_template</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">messages</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">query_prompt_template</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">messages</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">pretty_print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div style="padding-top:1.3rem;background:var(--prism-background-color);color:var(--prism-color);margin-top:calc(-1 * var(--ifm-leading) - 5px);margin-bottom:var(--ifm-leading);box-shadow:var(--ifm-global-shadow-lw);border-bottom-left-radius:var(--ifm-code-border-radius);border-bottom-right-radius:var(--ifm-code-border-radius)"><b style="padding-left:0.65rem;margin-bottom:0.45rem;margin-right:0.5rem">API Reference:</b><span><a href="https://python.langchain.com/api_reference/langchain/hub/langchain.hub.hub.html">hub</a></span></div>
<div class="language-output codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-output codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#F5F5F5"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">================================[1m System Message [0m================================</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Given an input question, create a syntactically correct [33;1m[1;3m{dialect}[0m query to run to help find the answer. Unless the user specifies in his question a specific number of examples they wish to obtain, always limit your query to at most [33;1m[1;3m{top_k}[0m results. You can order the results by a relevant column to return the most interesting examples in the database.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Never query for all the columns from a specific table, only ask for a the few relevant columns given the question.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Pay attention to use only the column names that you can see in the schema description. Be careful to not query for columns that do not exist. Also, pay attention to which column is in which table.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Only use the following tables:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">[33;1m[1;3m{table_info}[0m</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Question: [33;1m[1;3m{input}[0m</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>The prompt includes several parameters we will need to populate, such as the SQL dialect and table schemas. LangChain&#x27;s <a href="https://python.langchain.com/api_reference/community/utilities/langchain_community.utilities.sql_database.SQLDatabase.html" target="_blank" rel="noopener noreferrer">SQLDatabase</a> object includes methods to help with this. Our <code>write_query</code> step will just populate these parameters and prompt a model to generate the SQL query:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#F5F5F5"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">from</span><span class="token plain"> typing_extensions </span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> Annotated</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">class</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(38, 127, 153)">QueryOutput</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">TypedDict</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:rgb(163, 21, 21)">&quot;&quot;&quot;Generated SQL query.&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    query</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> Annotated</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token builtin" style="color:rgb(0, 112, 193)">str</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Syntactically valid SQL query.&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">write_query</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">state</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> State</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:rgb(163, 21, 21)">&quot;&quot;&quot;Generate SQL query to fetch information.&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    prompt </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> query_prompt_template</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">invoke</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;dialect&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> db</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">dialect</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;top_k&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">10</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;table_info&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> db</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">get_table_info</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">            </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;input&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> state</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;question&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    structured_llm </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> llm</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">with_structured_output</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">QueryOutput</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    result </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> structured_llm</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">invoke</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">prompt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;query&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> result</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;query&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Let&#x27;s test it out:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#F5F5F5"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">write_query</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;question&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;How many Employees are there?&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-output codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-output codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#F5F5F5"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;query&#x27;: &#x27;SELECT COUNT(EmployeeId) AS EmployeeCount FROM Employee;&#x27;}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="execute-query">Execute query<a href="#execute-query" class="hash-link" aria-label="Direct link to Execute query" title="Direct link to Execute query">‚Äã</a></h3>
<p><strong>This is the most dangerous part of creating a SQL chain.</strong> Consider carefully if it is OK to run automated queries over your data. Minimize the database connection permissions as much as possible. Consider adding a human approval step to you chains before query execution (see below).</p>
<p>To execute the query, we will load a tool from <a href="/docs/concepts/architecture/#langchain-community">langchain-community</a>. Our <code>execute_query</code> node will just wrap this tool:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#F5F5F5"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">from</span><span class="token plain"> langchain_community</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">tools</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">sql_database</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">tool </span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> QuerySQLDatabaseTool</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">execute_query</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">state</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> State</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:rgb(163, 21, 21)">&quot;&quot;&quot;Execute SQL query.&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    execute_query_tool </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> QuerySQLDatabaseTool</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">db</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">db</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;result&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> execute_query_tool</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">invoke</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">state</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;query&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div style="padding-top:1.3rem;background:var(--prism-background-color);color:var(--prism-color);margin-top:calc(-1 * var(--ifm-leading) - 5px);margin-bottom:var(--ifm-leading);box-shadow:var(--ifm-global-shadow-lw);border-bottom-left-radius:var(--ifm-code-border-radius);border-bottom-right-radius:var(--ifm-code-border-radius)"><b style="padding-left:0.65rem;margin-bottom:0.45rem;margin-right:0.5rem">API Reference:</b><span><a href="https://python.langchain.com/api_reference/community/tools/langchain_community.tools.sql_database.tool.QuerySQLDatabaseTool.html">QuerySQLDatabaseTool</a></span></div>
<p>Testing this step:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#F5F5F5"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">execute_query</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;query&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;SELECT COUNT(EmployeeId) AS EmployeeCount FROM Employee;&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-output codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-output codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#F5F5F5"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;result&#x27;: &#x27;[(8,)]&#x27;}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="generate-answer">Generate answer<a href="#generate-answer" class="hash-link" aria-label="Direct link to Generate answer" title="Direct link to Generate answer">‚Äã</a></h3>
<p>Finally, our last step generates an answer to the question given the information pulled from the database:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#F5F5F5"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">generate_answer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">state</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> State</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:rgb(163, 21, 21)">&quot;&quot;&quot;Answer question using retrieved information as context.&quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    prompt </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Given the following user question, corresponding SQL query, &quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;and SQL result, answer the user question.\n\n&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token string-interpolation string" style="color:rgb(163, 21, 21)">f&#x27;Question: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string-interpolation interpolation">state</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string-interpolation interpolation string" style="color:rgb(163, 21, 21)">&quot;question&quot;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token string-interpolation string" style="color:rgb(163, 21, 21)">\n&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token string-interpolation string" style="color:rgb(163, 21, 21)">f&#x27;SQL Query: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string-interpolation interpolation">state</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string-interpolation interpolation string" style="color:rgb(163, 21, 21)">&quot;query&quot;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token string-interpolation string" style="color:rgb(163, 21, 21)">\n&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token string-interpolation string" style="color:rgb(163, 21, 21)">f&#x27;SQL Result: </span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string-interpolation interpolation">state</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string-interpolation interpolation string" style="color:rgb(163, 21, 21)">&quot;result&quot;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token string-interpolation string" style="color:rgb(163, 21, 21)">&#x27;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    response </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> llm</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">invoke</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">prompt</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;answer&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> response</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">content</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="orchestrating-with-langgraph">Orchestrating with LangGraph<a href="#orchestrating-with-langgraph" class="hash-link" aria-label="Direct link to Orchestrating with LangGraph" title="Direct link to Orchestrating with LangGraph">‚Äã</a></h3>
<p>Finally, we compile our application into a single <code>graph</code> object. In this case, we are just connecting the three steps into a single sequence.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#F5F5F5"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">from</span><span class="token plain"> langgraph</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">graph </span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> START</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> StateGraph</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">graph_builder </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> StateGraph</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">State</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">add_sequence</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">write_query</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> execute_query</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> generate_answer</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">graph_builder</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">add_edge</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">START</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;write_query&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">graph </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> graph_builder</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token builtin" style="color:rgb(0, 112, 193)">compile</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div style="padding-top:1.3rem;background:var(--prism-background-color);color:var(--prism-color);margin-top:calc(-1 * var(--ifm-leading) - 5px);margin-bottom:var(--ifm-leading);box-shadow:var(--ifm-global-shadow-lw);border-bottom-left-radius:var(--ifm-code-border-radius);border-bottom-right-radius:var(--ifm-code-border-radius)"><b style="padding-left:0.65rem;margin-bottom:0.45rem;margin-right:0.5rem">API Reference:</b><span><a href="https://langchain-ai.github.io/langgraph/reference/graphs/#langgraph.graph.state.StateGraph">StateGraph</a></span></div>
<p>LangGraph also comes with built-in utilities for visualizing the control flow of your application:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#F5F5F5"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">from</span><span class="token plain"> IPython</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">display </span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> Image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> display</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">display</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">Image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">graph</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">get_graph</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">draw_mermaid_png</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,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" alt="" class="img_ev3q"></p>
<p>Let&#x27;s test our application! Note that we can stream the results of individual steps:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#F5F5F5"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> step </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> graph</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">stream</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;question&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;How many employees are there?&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> stream_mode</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;updates&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">step</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-output codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-output codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#F5F5F5"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;write_query&#x27;: {&#x27;query&#x27;: &#x27;SELECT COUNT(EmployeeId) AS EmployeeCount FROM Employee;&#x27;}}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;execute_query&#x27;: {&#x27;result&#x27;: &#x27;[(8,)]&#x27;}}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;generate_answer&#x27;: {&#x27;answer&#x27;: &#x27;There are 8 employees.&#x27;}}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Check out the <a href="https://smith.langchain.com/public/30a79380-6ba6-46af-8bd9-5d1df0b9ccca/r" target="_blank" rel="noopener noreferrer">LangSmith trace</a>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="human-in-the-loop">Human-in-the-loop<a href="#human-in-the-loop" class="hash-link" aria-label="Direct link to Human-in-the-loop" title="Direct link to Human-in-the-loop">‚Äã</a></h3>
<p>LangGraph supports a number of features that can be useful for this workflow. One of them is <a href="https://langchain-ai.github.io/langgraph/concepts/human_in_the_loop/" target="_blank" rel="noopener noreferrer">human-in-the-loop</a>: we can interrupt our application before sensitive steps (such as the execution of a SQL query) for human review. This is enabled by LangGraph&#x27;s <a href="https://langchain-ai.github.io/langgraph/concepts/persistence/" target="_blank" rel="noopener noreferrer">persistence</a> layer, which saves run progress to your storage of choice. Below, we specify storage in-memory:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#F5F5F5"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">from</span><span class="token plain"> langgraph</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">checkpoint</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">memory </span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> MemorySaver</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">memory </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> MemorySaver</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">graph </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> graph_builder</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token builtin" style="color:rgb(0, 112, 193)">compile</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">checkpointer</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">memory</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> interrupt_before</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;execute_query&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># Now that we&#x27;re using persistence, we need to specify a thread ID</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token comment" style="color:rgb(0, 128, 0)"># so that we can continue the run after review.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">config </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;configurable&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;thread_id&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;1&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div style="padding-top:1.3rem;background:var(--prism-background-color);color:var(--prism-color);margin-top:calc(-1 * var(--ifm-leading) - 5px);margin-bottom:var(--ifm-leading);box-shadow:var(--ifm-global-shadow-lw);border-bottom-left-radius:var(--ifm-code-border-radius);border-bottom-right-radius:var(--ifm-code-border-radius)"><b style="padding-left:0.65rem;margin-bottom:0.45rem;margin-right:0.5rem">API Reference:</b><span><a href="https://langchain-ai.github.io/langgraph/reference/checkpoints/#langgraph.checkpoint.memory.MemorySaver">MemorySaver</a></span></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#F5F5F5"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">display</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">Image</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">graph</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">get_graph</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">draw_mermaid_png</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img decoding="async" loading="lazy" src="data:image/png;base64,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" alt="" class="img_ev3q"></p>
<p>Let&#x27;s repeat the same run, adding in a simple yes/no approval step:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#F5F5F5"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> step </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> graph</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">stream</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;question&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;How many employees are there?&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    config</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    stream_mode</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;updates&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">step</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">try</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    user_approval </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(0, 112, 193)">input</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Do you want to go to execute query? (yes/no): &quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">except</span><span class="token plain"> Exception</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    user_approval </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;no&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> user_approval</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">lower</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;yes&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token comment" style="color:rgb(0, 128, 0)"># If approved, continue the graph execution</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> step </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> graph</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">stream</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token boolean">None</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> config</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> stream_mode</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;updates&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">        </span><span class="token keyword" style="color:rgb(0, 0, 255)">print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">step</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">else</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Operation cancelled by user.&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-output codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-output codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#F5F5F5"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;write_query&#x27;: {&#x27;query&#x27;: &#x27;SELECT COUNT(EmployeeId) AS EmployeeCount FROM Employee;&#x27;}}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;__interrupt__&#x27;: ()}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">``````output</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Do you want to go to execute query? (yes/no):  yes</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">``````output</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;execute_query&#x27;: {&#x27;result&#x27;: &#x27;[(8,)]&#x27;}}</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">{&#x27;generate_answer&#x27;: {&#x27;answer&#x27;: &#x27;There are 8 employees.&#x27;}}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>See <a href="https://langchain-ai.github.io/langgraph/concepts/human_in_the_loop/" target="_blank" rel="noopener noreferrer">this</a> LangGraph guide for more detail and examples.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="next-steps">Next steps<a href="#next-steps" class="hash-link" aria-label="Direct link to Next steps" title="Direct link to Next steps">‚Äã</a></h3>
<p>For more complex query-generation, we may want to create few-shot prompts or add query-checking steps. For advanced techniques like this and more check out:</p>
<ul>
<li><a href="/docs/how_to/sql_prompting/">Prompting strategies</a>: Advanced prompt engineering techniques.</li>
<li><a href="/docs/how_to/sql_query_checking/">Query checking</a>: Add query validation and error handling.</li>
<li><a href="/docs/how_to/sql_large_db/">Large databases</a>: Techniques for working with large databases.</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="agents">Agents<a href="#agents" class="hash-link" aria-label="Direct link to Agents" title="Direct link to Agents">‚Äã</a></h2>
<p><a href="/docs/concepts/agents/">Agents</a> leverage the reasoning capabilities of LLMs to make decisions during execution. Using agents allows you to offload additional discretion over the query generation and execution process. Although their behavior is less predictable than the above &quot;chain&quot;, they feature some advantages:</p>
<ul>
<li>They can query the database as many times as needed to answer the user question.</li>
<li>They can recover from errors by running a generated query, catching the traceback and regenerating it correctly.</li>
<li>They can answer questions based on the databases&#x27; schema as well as on the databases&#x27; content (like describing a specific table).</li>
</ul>
<p>Below we assemble a minimal SQL agent. We will equip it with a set of tools using LangChain&#x27;s <a href="https://python.langchain.com/api_reference/community/agent_toolkits/langchain_community.agent_toolkits.sql.toolkit.SQLDatabaseToolkit.html" target="_blank" rel="noopener noreferrer">SQLDatabaseToolkit</a>. Using LangGraph&#x27;s <a href="https://langchain-ai.github.io/langgraph/how-tos/#langgraph.prebuilt.chat_agent_executor.create_react_agent" target="_blank" rel="noopener noreferrer">pre-built ReAct agent constructor</a>, we can do this in one line.</p>
<div class="theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_BuS1"><p>Check out LangGraph&#x27;s <a href="https://langchain-ai.github.io/langgraph/tutorials/sql-agent/" target="_blank" rel="noopener noreferrer">SQL Agent Tutorial</a> for a more advanced formulation of a SQL agent.</p></div></div>
<p>The <code>SQLDatabaseToolkit</code> includes tools that can:</p>
<ul>
<li>Create and execute queries</li>
<li>Check query syntax</li>
<li>Retrieve table descriptions</li>
<li>... and more</li>
</ul>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#F5F5F5"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">from</span><span class="token plain"> langchain_community</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">agent_toolkits </span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> SQLDatabaseToolkit</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">toolkit </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> SQLDatabaseToolkit</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">db</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">db</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> llm</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">llm</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">tools </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> toolkit</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">get_tools</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">tools</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div style="padding-top:1.3rem;background:var(--prism-background-color);color:var(--prism-color);margin-top:calc(-1 * var(--ifm-leading) - 5px);margin-bottom:var(--ifm-leading);box-shadow:var(--ifm-global-shadow-lw);border-bottom-left-radius:var(--ifm-code-border-radius);border-bottom-right-radius:var(--ifm-code-border-radius)"><b style="padding-left:0.65rem;margin-bottom:0.45rem;margin-right:0.5rem">API Reference:</b><span><a href="https://python.langchain.com/api_reference/community/agent_toolkits/langchain_community.agent_toolkits.sql.toolkit.SQLDatabaseToolkit.html">SQLDatabaseToolkit</a></span></div>
<div class="language-output codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-output codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#F5F5F5"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">[QuerySQLDatabaseTool(description=&quot;Input to this tool is a detailed and correct SQL query, output is a result from the database. If the query is not correct, an error message will be returned. If an error is returned, rewrite the query, check the query, and try again. If you encounter an issue with Unknown column &#x27;xxxx&#x27; in &#x27;field list&#x27;, use sql_db_schema to query the correct table fields.&quot;, db=&lt;langchain_community.utilities.sql_database.SQLDatabase object at 0x10d5f9120&gt;),</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> InfoSQLDatabaseTool(description=&#x27;Input to this tool is a comma-separated list of tables, output is the schema and sample rows for those tables. Be sure that the tables actually exist by calling sql_db_list_tables first! Example Input: table1, table2, table3&#x27;, db=&lt;langchain_community.utilities.sql_database.SQLDatabase object at 0x10d5f9120&gt;),</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> ListSQLDatabaseTool(db=&lt;langchain_community.utilities.sql_database.SQLDatabase object at 0x10d5f9120&gt;),</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> QuerySQLCheckerTool(description=&#x27;Use this tool to double check if your query is correct before executing it. Always use this tool before executing a query with sql_db_query!&#x27;, db=&lt;langchain_community.utilities.sql_database.SQLDatabase object at 0x10d5f9120&gt;, llm=ChatOpenAI(client=&lt;openai.resources.chat.completions.Completions object at 0x119315480&gt;, async_client=&lt;openai.resources.chat.completions.AsyncCompletions object at 0x119317550&gt;, root_client=&lt;openai.OpenAI object at 0x10d5f8df0&gt;, root_async_client=&lt;openai.AsyncOpenAI object at 0x1193154e0&gt;, model_name=&#x27;gpt-4o&#x27;, temperature=0.0, model_kwargs={}, openai_api_key=SecretStr(&#x27;**********&#x27;)), llm_chain=LLMChain(verbose=False, prompt=PromptTemplate(input_variables=[&#x27;dialect&#x27;, &#x27;query&#x27;], input_types={}, partial_variables={}, template=&#x27;\n{query}\nDouble check the {dialect} query above for common mistakes, including:\n- Using NOT IN with NULL values\n- Using UNION when UNION ALL should have been used\n- Using BETWEEN for exclusive ranges\n- Data type mismatch in predicates\n- Properly quoting identifiers\n- Using the correct number of arguments for functions\n- Casting to the correct data type\n- Using the proper columns for joins\n\nIf there are any of the above mistakes, rewrite the query. If there are no mistakes, just reproduce the original query.\n\nOutput the final SQL query only.\n\nSQL Query: &#x27;), llm=ChatOpenAI(client=&lt;openai.resources.chat.completions.Completions object at 0x119315480&gt;, async_client=&lt;openai.resources.chat.completions.AsyncCompletions object at 0x119317550&gt;, root_client=&lt;openai.OpenAI object at 0x10d5f8df0&gt;, root_async_client=&lt;openai.AsyncOpenAI object at 0x1193154e0&gt;, model_name=&#x27;gpt-4o&#x27;, temperature=0.0, model_kwargs={}, openai_api_key=SecretStr(&#x27;**********&#x27;)), output_parser=StrOutputParser(), llm_kwargs={}))]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="system-prompt">System Prompt<a href="#system-prompt" class="hash-link" aria-label="Direct link to System Prompt" title="Direct link to System Prompt">‚Äã</a></h3>
<p>We will also want to load a system prompt for our agent. This will consist of instructions for how to behave.</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#F5F5F5"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">from</span><span class="token plain"> langchain </span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> hub</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">prompt_template </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> hub</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">pull</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;langchain-ai/sql-agent-system-prompt&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">assert</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(0, 112, 193)">len</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">prompt_template</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">messages</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">==</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">prompt_template</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">messages</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token number" style="color:rgb(9, 134, 88)">0</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">pretty_print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div style="padding-top:1.3rem;background:var(--prism-background-color);color:var(--prism-color);margin-top:calc(-1 * var(--ifm-leading) - 5px);margin-bottom:var(--ifm-leading);box-shadow:var(--ifm-global-shadow-lw);border-bottom-left-radius:var(--ifm-code-border-radius);border-bottom-right-radius:var(--ifm-code-border-radius)"><b style="padding-left:0.65rem;margin-bottom:0.45rem;margin-right:0.5rem">API Reference:</b><span><a href="https://python.langchain.com/api_reference/langchain/hub/langchain.hub.hub.html">hub</a></span></div>
<div class="language-output codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-output codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#F5F5F5"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">================================[1m System Message [0m================================</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">You are an agent designed to interact with a SQL database.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Given an input question, create a syntactically correct [33;1m[1;3m{dialect}[0m query to run, then look at the results of the query and return the answer.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Unless the user specifies a specific number of examples they wish to obtain, always limit your query to at most [33;1m[1;3m{top_k}[0m results.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">You can order the results by a relevant column to return the most interesting examples in the database.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Never query for all the columns from a specific table, only ask for the relevant columns given the question.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">You have access to tools for interacting with the database.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Only use the below tools. Only use the information returned by the below tools to construct your final answer.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">You MUST double check your query before executing it. If you get an error while executing a query, rewrite the query and try again.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">DO NOT make any DML statements (INSERT, UPDATE, DELETE, DROP etc.) to the database.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">To start you should ALWAYS look at the tables in the database to see what you can query.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Do NOT skip this step.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Then you should query the schema of the most relevant tables.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Let&#x27;s populate the parameters highlighted in the prompt:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#F5F5F5"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">system_message </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> prompt_template</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token builtin" style="color:rgb(0, 112, 193)">format</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">dialect</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;SQLite&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> top_k</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="initializing-agent">Initializing agent<a href="#initializing-agent" class="hash-link" aria-label="Direct link to Initializing agent" title="Direct link to Initializing agent">‚Äã</a></h3>
<p>We will use a prebuilt <a href="/docs/concepts/architecture/#langgraph">LangGraph</a> agent to build our agent</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#F5F5F5"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">from</span><span class="token plain"> langchain_core</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">messages </span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> HumanMessage</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">from</span><span class="token plain"> langgraph</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">prebuilt </span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> create_react_agent</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">agent_executor </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> create_react_agent</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">llm</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> tools</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> state_modifier</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">system_message</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div style="padding-top:1.3rem;background:var(--prism-background-color);color:var(--prism-color);margin-top:calc(-1 * var(--ifm-leading) - 5px);margin-bottom:var(--ifm-leading);box-shadow:var(--ifm-global-shadow-lw);border-bottom-left-radius:var(--ifm-code-border-radius);border-bottom-right-radius:var(--ifm-code-border-radius)"><b style="padding-left:0.65rem;margin-bottom:0.45rem;margin-right:0.5rem">API Reference:</b><span><a href="https://python.langchain.com/api_reference/core/messages/langchain_core.messages.human.HumanMessage.html">HumanMessage</a> | </span><span><a href="https://langchain-ai.github.io/langgraph/reference/prebuilt/#langgraph.prebuilt.chat_agent_executor.create_react_agent">create_react_agent</a></span></div>
<p>Consider how the agent responds to the below question:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#F5F5F5"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">question </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Which country&#x27;s customers spent the most?&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> step </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> agent_executor</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">stream</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;messages&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;role&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;user&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;content&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> question</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    stream_mode</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;values&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    step</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;messages&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">pretty_print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-output codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-output codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#F5F5F5"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">================================[1m Human Message [0m=================================</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Which country&#x27;s customers spent the most?</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">==================================[1m Ai Message [0m==================================</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Tool Calls:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  sql_db_list_tables (call_tFp7HYD6sAAmCShgeqkVZH6Q)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> Call ID: call_tFp7HYD6sAAmCShgeqkVZH6Q</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  Args:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">=================================[1m Tool Message [0m=================================</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Name: sql_db_list_tables</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Album, Artist, Customer, Employee, Genre, Invoice, InvoiceLine, MediaType, Playlist, PlaylistTrack, Track</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">==================================[1m Ai Message [0m==================================</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Tool Calls:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  sql_db_schema (call_KJZ1Jx6JazyDdJa0uH1UeiOz)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> Call ID: call_KJZ1Jx6JazyDdJa0uH1UeiOz</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  Args:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    table_names: Customer, Invoice</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">=================================[1m Tool Message [0m=================================</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Name: sql_db_schema</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">CREATE TABLE &quot;Customer&quot; (</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">	&quot;CustomerId&quot; INTEGER NOT NULL, </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">	&quot;FirstName&quot; NVARCHAR(40) NOT NULL, </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">	&quot;LastName&quot; NVARCHAR(20) NOT NULL, </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">	&quot;Company&quot; NVARCHAR(80), </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">	&quot;Address&quot; NVARCHAR(70), </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">	&quot;City&quot; NVARCHAR(40), </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">	&quot;State&quot; NVARCHAR(40), </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">	&quot;Country&quot; NVARCHAR(40), </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">	&quot;PostalCode&quot; NVARCHAR(10), </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">	&quot;Phone&quot; NVARCHAR(24), </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">	&quot;Fax&quot; NVARCHAR(24), </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">	&quot;Email&quot; NVARCHAR(60) NOT NULL, </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">	&quot;SupportRepId&quot; INTEGER, </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">	PRIMARY KEY (&quot;CustomerId&quot;), </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">	FOREIGN KEY(&quot;SupportRepId&quot;) REFERENCES &quot;Employee&quot; (&quot;EmployeeId&quot;)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/*</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">3 rows from Customer table:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">CustomerId	FirstName	LastName	Company	Address	City	State	Country	PostalCode	Phone	Fax	Email	SupportRepId</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">1	Lu√≠s	Gon√ßalves	Embraer - Empresa Brasileira de Aeron√°utica S.A.	Av. Brigadeiro Faria Lima, 2170	S√£o Jos√© dos Campos	SP	Brazil	12227-000	+55 (12) 3923-5555	+55 (12) 3923-5566	luisg@embraer.com.br	3</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">2	Leonie	K√∂hler	None	Theodor-Heuss-Stra√üe 34	Stuttgart	None	Germany	70174	+49 0711 2842222	None	leonekohler@surfeu.de	5</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">3	Fran√ßois	Tremblay	None	1498 rue B√©langer	Montr√©al	QC	Canada	H2G 1A7	+1 (514) 721-4711	None	ftremblay@gmail.com	3</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">*/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">CREATE TABLE &quot;Invoice&quot; (</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">	&quot;InvoiceId&quot; INTEGER NOT NULL, </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">	&quot;CustomerId&quot; INTEGER NOT NULL, </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">	&quot;InvoiceDate&quot; DATETIME NOT NULL, </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">	&quot;BillingAddress&quot; NVARCHAR(70), </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">	&quot;BillingCity&quot; NVARCHAR(40), </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">	&quot;BillingState&quot; NVARCHAR(40), </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">	&quot;BillingCountry&quot; NVARCHAR(40), </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">	&quot;BillingPostalCode&quot; NVARCHAR(10), </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">	&quot;Total&quot; NUMERIC(10, 2) NOT NULL, </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">	PRIMARY KEY (&quot;InvoiceId&quot;), </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">	FOREIGN KEY(&quot;CustomerId&quot;) REFERENCES &quot;Customer&quot; (&quot;CustomerId&quot;)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/*</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">3 rows from Invoice table:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">InvoiceId	CustomerId	InvoiceDate	BillingAddress	BillingCity	BillingState	BillingCountry	BillingPostalCode	Total</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">1	2	2021-01-01 00:00:00	Theodor-Heuss-Stra√üe 34	Stuttgart	None	Germany	70174	1.98</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">2	4	2021-01-02 00:00:00	Ullev√•lsveien 14	Oslo	None	Norway	0171	3.96</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">3	8	2021-01-03 00:00:00	Gr√©trystraat 63	Brussels	None	Belgium	1000	5.94</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">*/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">==================================[1m Ai Message [0m==================================</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Tool Calls:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  sql_db_query_checker (call_AQuTGbgH63u4gPgyV723yrjX)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> Call ID: call_AQuTGbgH63u4gPgyV723yrjX</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  Args:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    query: SELECT c.Country, SUM(i.Total) as TotalSpent FROM Customer c JOIN Invoice i ON c.CustomerId = i.CustomerId GROUP BY c.Country ORDER BY TotalSpent DESC LIMIT 1;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">=================================[1m Tool Message [0m=================================</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Name: sql_db_query_checker</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">\`\`\`sql</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">SELECT c.Country, SUM(i.Total) as TotalSpent FROM Customer c JOIN Invoice i ON c.CustomerId = i.CustomerId GROUP BY c.Country ORDER BY TotalSpent DESC LIMIT 1;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">\`\`\`</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">==================================[1m Ai Message [0m==================================</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Tool Calls:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  sql_db_query (call_B88EwU44nwwpQL5M9nlcemSU)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> Call ID: call_B88EwU44nwwpQL5M9nlcemSU</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  Args:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    query: SELECT c.Country, SUM(i.Total) as TotalSpent FROM Customer c JOIN Invoice i ON c.CustomerId = i.CustomerId GROUP BY c.Country ORDER BY TotalSpent DESC LIMIT 1;</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">=================================[1m Tool Message [0m=================================</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Name: sql_db_query</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">[(&#x27;USA&#x27;, 523.06)]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">==================================[1m Ai Message [0m==================================</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">The country whose customers spent the most is the USA, with a total spending of 523.06.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You can also use the <a href="https://smith.langchain.com/public/8af422aa-b651-4bfe-8683-e2a7f4ccd82c/r" target="_blank" rel="noopener noreferrer">LangSmith trace</a> to visualize these steps and associated metadata.</p>
<p>Note that the agent executes multiple queries until it has the information it needs:</p>
<ol>
<li>List available tables;</li>
<li>Retrieves the schema for three tables;</li>
<li>Queries multiple of the tables via a join operation.</li>
</ol>
<p>The agent is then able to use the result of the final query to generate an answer to the original question.</p>
<p>The agent can similarly handle qualitative questions:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#F5F5F5"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">question </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Describe the playlisttrack table&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> step </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> agent_executor</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">stream</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;messages&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;role&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;user&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;content&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> question</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    stream_mode</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;values&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    step</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;messages&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">pretty_print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-output codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-output codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#F5F5F5"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">================================[1m Human Message [0m=================================</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Describe the playlisttrack table</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">==================================[1m Ai Message [0m==================================</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Tool Calls:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  sql_db_list_tables (call_fMF8eTmX5TJDJjc3Mhdg52TI)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> Call ID: call_fMF8eTmX5TJDJjc3Mhdg52TI</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  Args:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">=================================[1m Tool Message [0m=================================</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Name: sql_db_list_tables</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Album, Artist, Customer, Employee, Genre, Invoice, InvoiceLine, MediaType, Playlist, PlaylistTrack, Track</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">==================================[1m Ai Message [0m==================================</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Tool Calls:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  sql_db_schema (call_W8Vkk4NEodkAAIg8nexAszUH)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> Call ID: call_W8Vkk4NEodkAAIg8nexAszUH</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  Args:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    table_names: PlaylistTrack</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">=================================[1m Tool Message [0m=================================</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Name: sql_db_schema</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">CREATE TABLE &quot;PlaylistTrack&quot; (</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">	&quot;PlaylistId&quot; INTEGER NOT NULL, </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">	&quot;TrackId&quot; INTEGER NOT NULL, </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">	PRIMARY KEY (&quot;PlaylistId&quot;, &quot;TrackId&quot;), </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">	FOREIGN KEY(&quot;TrackId&quot;) REFERENCES &quot;Track&quot; (&quot;TrackId&quot;), </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">	FOREIGN KEY(&quot;PlaylistId&quot;) REFERENCES &quot;Playlist&quot; (&quot;PlaylistId&quot;)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/*</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">3 rows from PlaylistTrack table:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">PlaylistId	TrackId</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">1	3402</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">1	3389</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">1	3390</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">*/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">==================================[1m Ai Message [0m==================================</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">The `PlaylistTrack` table is designed to associate tracks with playlists. It has the following structure:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">- **PlaylistId**: An integer that serves as a foreign key referencing the `Playlist` table. It is part of the composite primary key.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">- **TrackId**: An integer that serves as a foreign key referencing the `Track` table. It is also part of the composite primary key.</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">The primary key for this table is a composite key consisting of both `PlaylistId` and `TrackId`, ensuring that each track can be uniquely associated with a playlist. The table enforces referential integrity by linking to the `Track` and `Playlist` tables through foreign keys.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="dealing-with-high-cardinality-columns">Dealing with high-cardinality columns<a href="#dealing-with-high-cardinality-columns" class="hash-link" aria-label="Direct link to Dealing with high-cardinality columns" title="Direct link to Dealing with high-cardinality columns">‚Äã</a></h3>
<p>In order to filter columns that contain proper nouns such as addresses, song names or artists, we first need to double-check the spelling in order to filter the data correctly.</p>
<p>We can achieve this by creating a vector store with all the distinct proper nouns that exist in the database. We can then have the agent query that vector store each time the user includes a proper noun in their question, to find the correct spelling for that word. In this way, the agent can make sure it understands which entity the user is referring to before building the target query.</p>
<p>First we need the unique values for each entity we want, for which we define a function that parses the result into a list of elements:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#F5F5F5"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> ast</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> re</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">def</span><span class="token plain"> </span><span class="token function" style="color:rgb(0, 0, 255)">query_as_list</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">db</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> query</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    res </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> db</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">run</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">query</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    res </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">el </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> sub </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> ast</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">literal_eval</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">res</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> el </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> sub </span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> el</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    res </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token plain">re</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">sub</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">r&quot;\b\d+\b&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> string</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">strip</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> string </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> res</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token keyword" style="color:rgb(0, 0, 255)">return</span><span class="token plain"> </span><span class="token builtin" style="color:rgb(0, 112, 193)">list</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token builtin" style="color:rgb(0, 112, 193)">set</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">res</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">artists </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> query_as_list</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">db</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;SELECT Name FROM Artist&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">albums </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> query_as_list</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">db</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;SELECT Title FROM Album&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">albums</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-output codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-output codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#F5F5F5"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">[&#x27;In Through The Out Door&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> &#x27;Transmission&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> &#x27;Battlestar Galactica (Classic), Season&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> &#x27;A Copland Celebration, Vol. I&#x27;,</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> &#x27;Quiet Songs&#x27;]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Using this function, we can create a <strong>retriever tool</strong> that the agent can execute at its discretion.</p>
<p>Let&#x27;s select an <a href="/docs/integrations/text_embedding/">embeddings model</a> and <a href="/docs/integrations/vectorstores/">vector store</a> for this step:</p>
<p><strong>Select an embedding model</strong>:</p>
<!-- -->
<div><div style="display:flex;align-items:center;margin-bottom:1rem;gap:0.75rem"><span style="font-size:1rem;font-weight:500">Select <a href="/docs/integrations/text_embedding/">embeddings model</a>:</span><div class="dropdown"><button class="button button--secondary" style="background-color:var(--ifm-background-color);border:1px solid var(--ifm-color-emphasis-300);font-weight:normal;font-size:1rem;padding:0.5rem 1rem;color:var(--ifm-font-color-base)">OpenAI<span style="margin-left:0.4rem;font-size:0.875rem">‚ñæ</span></button><div class="dropdown__menu" style="max-height:210px;overflow-y:auto;overflow-x:hidden;margin-bottom:0"><li><a class="dropdown__link dropdown__link--active" href="#">OpenAI</a></li><li><a class="dropdown__link" href="#">Azure</a></li><li><a class="dropdown__link" href="#">Google</a></li><li><a class="dropdown__link" href="#">AWS</a></li><li><a class="dropdown__link" href="#">HuggingFace</a></li><li><a class="dropdown__link" href="#">Ollama</a></li><li><a class="dropdown__link" href="#">Cohere</a></li><li><a class="dropdown__link" href="#">MistralAI</a></li><li><a class="dropdown__link" href="#">Nomic</a></li><li><a class="dropdown__link" href="#">NVIDIA</a></li><li><a class="dropdown__link" href="#">Voyage AI</a></li><li><a class="dropdown__link" href="#">Fake</a></li></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#F5F5F5"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">pip install -qU langchain-openai</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#F5F5F5"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> getpass</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> os</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">if</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(0, 0, 255)">not</span><span class="token plain"> os</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">environ</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">get</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;OPENAI_API_KEY&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  os</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">environ</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;OPENAI_API_KEY&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token plain"> </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> getpass</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">getpass</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Enter API key for OpenAI: &quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">from</span><span class="token plain"> langchain_openai </span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> OpenAIEmbeddings</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">embeddings </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> OpenAIEmbeddings</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">model</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;text-embedding-3-large&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div>
<p><strong>Select a vector store</strong>:</p>
<!-- -->
<div><div style="display:flex;align-items:center;margin-bottom:1rem;gap:0.75rem"><span style="font-size:1rem;font-weight:500">Select <a href="/docs/integrations/vectorstores/">vector store</a>:</span><div class="dropdown"><button class="button button--secondary" style="background-color:var(--ifm-background-color);border:1px solid var(--ifm-color-emphasis-300);font-weight:normal;font-size:1rem;padding:0.5rem 1rem;color:var(--ifm-font-color-base)">In-memory<span style="margin-left:0.4rem;font-size:0.875rem">‚ñæ</span></button><div class="dropdown__menu" style="max-height:210px;overflow-y:auto;overflow-x:hidden;margin-bottom:0"><li><a class="dropdown__link dropdown__link--active" href="#">In-memory</a></li><li><a class="dropdown__link" href="#">AstraDB</a></li><li><a class="dropdown__link" href="#">Chroma</a></li><li><a class="dropdown__link" href="#">FAISS</a></li><li><a class="dropdown__link" href="#">Milvus</a></li><li><a class="dropdown__link" href="#">MongoDB</a></li><li><a class="dropdown__link" href="#">PGVector</a></li><li><a class="dropdown__link" href="#">Pinecone</a></li><li><a class="dropdown__link" href="#">Qdrant</a></li></div></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#F5F5F5"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">pip install -qU langchain-core</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#F5F5F5"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">from</span><span class="token plain"> langchain_core</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">vectorstores </span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> InMemoryVectorStore</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">vector_store </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> InMemoryVectorStore</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">embeddings</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div>
<p>We can now construct a retrieval tool that can search over relevant proper nouns in the database:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#F5F5F5"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">from</span><span class="token plain"> langchain</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">agents</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">agent_toolkits </span><span class="token keyword" style="color:rgb(0, 0, 255)">import</span><span class="token plain"> create_retriever_tool</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">_ </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> vector_store</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">add_texts</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">artists </span><span class="token operator" style="color:rgb(0, 0, 0)">+</span><span class="token plain"> albums</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">retriever </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> vector_store</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">as_retriever</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">search_kwargs</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;k&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(9, 134, 88)">5</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">description </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Use to look up values to filter on. Input is an approximate spelling &quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;of the proper noun, output is valid proper nouns. Use the noun most &quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;similar to the search.&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">retriever_tool </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> create_retriever_tool</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    retriever</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    name</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;search_proper_nouns&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    description</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">description</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div style="padding-top:1.3rem;background:var(--prism-background-color);color:var(--prism-color);margin-top:calc(-1 * var(--ifm-leading) - 5px);margin-bottom:var(--ifm-leading);box-shadow:var(--ifm-global-shadow-lw);border-bottom-left-radius:var(--ifm-code-border-radius);border-bottom-right-radius:var(--ifm-code-border-radius)"><b style="padding-left:0.65rem;margin-bottom:0.45rem;margin-right:0.5rem">API Reference:</b><span><a href="https://python.langchain.com/api_reference/core/tools/langchain_core.tools.retriever.create_retriever_tool.html">create_retriever_tool</a></span></div>
<p>Let&#x27;s try it out:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#F5F5F5"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token keyword" style="color:rgb(0, 0, 255)">print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">retriever_tool</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">invoke</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;Alice Chains&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-output codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-output codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#F5F5F5"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">Alice In Chains</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Alanis Morissette</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Pearl Jam</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Pearl Jam</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Audioslave</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>This way, if the agent determines it needs to write a filter based on an artist along the lines of &quot;Alice Chains&quot;, it can first use the retriever tool to observe relevant values of a column.</p>
<p>Putting this together:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#F5F5F5"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token comment" style="color:rgb(0, 128, 0)"># Add to system message</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">suffix </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;If you need to filter on a proper noun like a Name, you must ALWAYS first look up &quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;the filter value using the &#x27;search_proper_nouns&#x27; tool! Do not try to &quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;guess at the proper name - use this function to find similar ones.&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">system </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string-interpolation string" style="color:rgb(163, 21, 21)">f&quot;</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string-interpolation interpolation">system_message</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token string-interpolation string" style="color:rgb(163, 21, 21)">\n\n</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string-interpolation interpolation">suffix</span><span class="token string-interpolation interpolation punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token string-interpolation string" style="color:rgb(163, 21, 21)">&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">tools</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">append</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">retriever_tool</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">agent </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> create_react_agent</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain">llm</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> tools</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> state_modifier</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain">system</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#F5F5F5"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">question </span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;How many albums does alis in chain have?&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token keyword" style="color:rgb(0, 0, 255)">for</span><span class="token plain"> step </span><span class="token keyword" style="color:rgb(0, 0, 255)">in</span><span class="token plain"> agent</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">stream</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;messages&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token punctuation" style="color:rgb(4, 81, 165)">{</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;role&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;user&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(163, 21, 21)">&quot;content&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"> question</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">}</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    stream_mode</span><span class="token operator" style="color:rgb(0, 0, 0)">=</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;values&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain"></span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><span class="token punctuation" style="color:rgb(4, 81, 165)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    step</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token string" style="color:rgb(163, 21, 21)">&quot;messages&quot;</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">[</span><span class="token operator" style="color:rgb(0, 0, 0)">-</span><span class="token number" style="color:rgb(9, 134, 88)">1</span><span class="token punctuation" style="color:rgb(4, 81, 165)">]</span><span class="token punctuation" style="color:rgb(4, 81, 165)">.</span><span class="token plain">pretty_print</span><span class="token punctuation" style="color:rgb(4, 81, 165)">(</span><span class="token punctuation" style="color:rgb(4, 81, 165)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-output codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#000000;--prism-background-color:#F5F5F5"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-output codeBlock_bY9V thin-scrollbar" style="color:#000000;background-color:#F5F5F5"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#000000"><span class="token plain">================================[1m Human Message [0m=================================</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">How many albums does alis in chain have?</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">==================================[1m Ai Message [0m==================================</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Tool Calls:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  search_proper_nouns (call_8ryjsRPLAr79mM3Qvnq6gTOH)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> Call ID: call_8ryjsRPLAr79mM3Qvnq6gTOH</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  Args:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    query: alis in chain</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">=================================[1m Tool Message [0m=================================</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Name: search_proper_nouns</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Alice In Chains</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Aisha Duo</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Xis</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Da Lama Ao Caos</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">A-Sides</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">==================================[1m Ai Message [0m==================================</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Tool Calls:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  sql_db_list_tables (call_NJjtCpU89MBMplssjn1z0xzq)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> Call ID: call_NJjtCpU89MBMplssjn1z0xzq</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  Args:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  search_proper_nouns (call_1BfrueC9koSIyi4OfMu2Ao8q)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> Call ID: call_1BfrueC9koSIyi4OfMu2Ao8q</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  Args:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    query: Alice In Chains</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">=================================[1m Tool Message [0m=================================</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Name: search_proper_nouns</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Alice In Chains</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Pearl Jam</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Pearl Jam</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Foo Fighters</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Soundgarden</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">==================================[1m Ai Message [0m==================================</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Tool Calls:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  sql_db_schema (call_Kn09w9jd9swcNzIZ1b5MlKID)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> Call ID: call_Kn09w9jd9swcNzIZ1b5MlKID</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  Args:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    table_names: Album, Artist</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">=================================[1m Tool Message [0m=================================</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Name: sql_db_schema</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">CREATE TABLE &quot;Album&quot; (</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">	&quot;AlbumId&quot; INTEGER NOT NULL, </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">	&quot;Title&quot; NVARCHAR(160) NOT NULL, </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">	&quot;ArtistId&quot; INTEGER NOT NULL, </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">	PRIMARY KEY (&quot;AlbumId&quot;), </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">	FOREIGN KEY(&quot;ArtistId&quot;) REFERENCES &quot;Artist&quot; (&quot;ArtistId&quot;)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/*</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">3 rows from Album table:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">AlbumId	Title	ArtistId</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">1	For Those About To Rock We Salute You	1</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">2	Balls to the Wall	2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">3	Restless and Wild	2</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">*/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">CREATE TABLE &quot;Artist&quot; (</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">	&quot;ArtistId&quot; INTEGER NOT NULL, </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">	&quot;Name&quot; NVARCHAR(120), </span><br></span><span class="token-line" style="color:#000000"><span class="token plain">	PRIMARY KEY (&quot;ArtistId&quot;)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">/*</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">3 rows from Artist table:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">ArtistId	Name</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">1	AC/DC</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">2	Accept</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">3	Aerosmith</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">*/</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">==================================[1m Ai Message [0m==================================</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Tool Calls:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  sql_db_query (call_WkHRiPcBoGN9bc58MIupRHKP)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain"> Call ID: call_WkHRiPcBoGN9bc58MIupRHKP</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">  Args:</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">    query: SELECT COUNT(*) FROM Album WHERE ArtistId = (SELECT ArtistId FROM Artist WHERE Name = &#x27;Alice In Chains&#x27;)</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">=================================[1m Tool Message [0m=================================</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Name: sql_db_query</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">[(1,)]</span><br></span><span class="token-line" style="color:#000000"><span class="token plain">==================================[1m Ai Message [0m==================================</span><br></span><span class="token-line" style="color:#000000"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#000000"><span class="token plain">Alice In Chains has released 1 album in the database.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>As we can see, both in the streamed steps and in the <a href="https://smith.langchain.com/public/1d757ed2-5688-4458-9400-023594e2c5a7/r" target="_blank" rel="noopener noreferrer">LangSmith trace</a>, the agent used the <code>search_proper_nouns</code> tool in order to check how to correctly query the database for this specific artist.</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col"><a href="https://github.com/langchain-ai/langchain/edit/master/docs/docs/tutorials/sql_qa.ipynb" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><div style="display:flex;flex-direction:column"><hr><h4>Was this page helpful?</h4><div style="display:flex;gap:5px"><div style="display:flex;align-items:center;padding-top:10px;padding-bottom:10px;padding-left:22px;padding-right:22px;border:1px solid gray;border-radius:6px;gap:10px;cursor:pointer;font-size:16px;font-weight:600" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="#166534" style="width:24px;height:24px"><path stroke-linecap="round" stroke-linejoin="round" d="M6.633 10.25c.806 0 1.533-.446 2.031-1.08a9.041 9.041 0 0 1 2.861-2.4c.723-.384 1.35-.956 1.653-1.715a4.498 4.498 0 0 0 .322-1.672V2.75a.75.75 0 0 1 .75-.75 2.25 2.25 0 0 1 2.25 2.25c0 1.152-.26 2.243-.723 3.218-.266.558.107 1.282.725 1.282m0 0h3.126c1.026 0 1.945.694 2.054 1.715.045.422.068.85.068 1.285a11.95 11.95 0 0 1-2.649 7.521c-.388.482-.987.729-1.605.729H13.48c-.483 0-.964-.078-1.423-.23l-3.114-1.04a4.501 4.501 0 0 0-1.423-.23H5.904m10.598-9.75H14.25M5.904 18.5c.083.205.173.405.27.602.197.4-.078.898-.523.898h-.908c-.889 0-1.713-.518-1.972-1.368a12 12 0 0 1-.521-3.507c0-1.553.295-3.036.831-4.398C3.387 9.953 4.167 9.5 5 9.5h1.053c.472 0 .745.556.5.96a8.958 8.958 0 0 0-1.302 4.665c0 1.194.232 2.333.654 3.375Z"></path></svg></div><div style="display:flex;align-items:center;padding-top:10px;padding-bottom:10px;padding-left:22px;padding-right:22px;border:1px solid gray;border-radius:6px;gap:10px;cursor:pointer;font-size:16px;font-weight:600" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="#991b1b" style="width:24px;height:24px"><path stroke-linecap="round" stroke-linejoin="round" d="M7.498 15.25H4.372c-1.026 0-1.945-.694-2.054-1.715a12.137 12.137 0 0 1-.068-1.285c0-2.848.992-5.464 2.649-7.521C5.287 4.247 5.886 4 6.504 4h4.016a4.5 4.5 0 0 1 1.423.23l3.114 1.04a4.5 4.5 0 0 0 1.423.23h1.294M7.498 15.25c.618 0 .991.724.725 1.282A7.471 7.471 0 0 0 7.5 19.75 2.25 2.25 0 0 0 9.75 22a.75.75 0 0 0 .75-.75v-.633c0-.573.11-1.14.322-1.672.304-.76.93-1.33 1.653-1.715a9.04 9.04 0 0 0 2.86-2.4c.498-.634 1.226-1.08 2.032-1.08h.384m-10.253 1.5H9.7m8.075-9.75c.01.05.027.1.05.148.593 1.2.925 2.55.925 3.977 0 1.487-.36 2.89-.999 4.125m.023-8.25c-.076-.365.183-.75.575-.75h.908c.889 0 1.713.518 1.972 1.368.339 1.11.521 2.287.521 3.507 0 1.553-.295 3.036-.831 4.398-.306.774-1.086 1.227-1.918 1.227h-1.053c-.472 0-.745-.556-.5-.96a8.95 8.95 0 0 0 .303-.54"></path></svg></div></div></div><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/tutorials/retrievers/"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Build a semantic search engine</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/tutorials/summarization/"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Summarize Text</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#Ô∏è-security-note-Ô∏è" class="table-of-contents__link toc-highlight">‚ö†Ô∏è Security note ‚ö†Ô∏è</a></li><li><a href="#architecture" class="table-of-contents__link toc-highlight">Architecture</a></li><li><a href="#setup" class="table-of-contents__link toc-highlight">Setup</a><ul><li><a href="#sample-data" class="table-of-contents__link toc-highlight">Sample data</a></li></ul></li><li><a href="#chains" class="table-of-contents__link toc-highlight">Chains</a><ul><li><a href="#application-state" class="table-of-contents__link toc-highlight">Application state</a></li><li><a href="#convert-question-to-sql-query" class="table-of-contents__link toc-highlight">Convert question to SQL query</a></li><li><a href="#execute-query" class="table-of-contents__link toc-highlight">Execute query</a></li><li><a href="#generate-answer" class="table-of-contents__link toc-highlight">Generate answer</a></li><li><a href="#orchestrating-with-langgraph" class="table-of-contents__link toc-highlight">Orchestrating with LangGraph</a></li><li><a href="#human-in-the-loop" class="table-of-contents__link toc-highlight">Human-in-the-loop</a></li><li><a href="#next-steps" class="table-of-contents__link toc-highlight">Next steps</a></li></ul></li><li><a href="#agents" class="table-of-contents__link toc-highlight">Agents</a><ul><li><a href="#system-prompt" class="table-of-contents__link toc-highlight">System Prompt</a></li><li><a href="#initializing-agent" class="table-of-contents__link toc-highlight">Initializing agent</a></li><li><a href="#dealing-with-high-cardinality-columns" class="table-of-contents__link toc-highlight">Dealing with high-cardinality columns</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://twitter.com/LangChainAI" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">GitHub</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/langchain-ai" target="_blank" rel="noopener noreferrer" class="footer__link-item">Organization<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/langchain-ai/langchain" target="_blank" rel="noopener noreferrer" class="footer__link-item">Python<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/langchain-ai/langchainjs" target="_blank" rel="noopener noreferrer" class="footer__link-item">JS/TS<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://langchain.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Homepage<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://blog.langchain.dev" target="_blank" rel="noopener noreferrer" class="footer__link-item">Blog<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/@LangChain" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright ¬© 2025 LangChain, Inc.</div></div></div></footer></div>
</body>
</html>